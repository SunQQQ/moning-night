<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>发动态</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <link href="css/base.css" rel="stylesheet" type="text/css">
    <link href="css/iconfont.css" rel="stylesheet" type="text/css">
    <link href="css/circle_add.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="topbar">
    <a class="left" href="circle.html">
        <i class="iconfont">&#xe620;</i>
    </a>
    <div class="center">发动态</div>
    <div class="right">
        发表
    </div>
</div>
<div class="menu_hold"></div>
<div class="addArea">
    <textarea placeholder="说点什么吧..." id="addText" value="txt" name="txtInput"></textarea>

    <div class="images"></div>

    <div class="pics_button">
        <div class="camara">
            <i class="iconfont icon_camara">&#xe60e;</i>
        </div>
        <div class="hint">照片</div>
        <input type="file" class="picInput" onchange="imageUpload(this)" multiple="multiple">
    </div>
</div>

<script src="js/jquery-3.2.1.min.js"></script>
<script>
    var images = document.getElementsByClassName("images")[0];
    var imgArray = [];


    document.getElementsByClassName("right")[0].onclick = function () {
        var picData = new FormData();
        imgArray = JSON.stringify(imgArray);
        picData.append('picInput',imgArray);
        picData.append('txtInput',document.getElementById("addText").value);

//        var xhrForm = new XMLHttpRequest();
//        xhrForm.open("POST", "http://localhost/proxy/sunq/moningNight/app/addshuoshuo.php");
//        xhrForm.send(picData);

        $.ajax(
            {
                url:"http://localhost/proxy/sunq/moningNight/app/addshuoshuo.php",
                type:"POST",
                processData: false,
                contentType:false,
                data:picData,
                datatype:"json",
                success:function (ret) {
                    console.log("ajax成功");
                    console.log(JSON.parse(ret));
                }
            }
        );
    }

    function imageUpload(file) {
        for(var i=0,f;f=file.files[i];i++){
            var fileRader = new FileReader();
            fileRader.readAsDataURL(f);
            fileRader.onload = function (event) {
                drawPic(event.target.result);
                imgArray.push(event.target.result);
            }
        }
        console.log(imgArray);
    }
    function drawPic(url) {
        var imageElement = document.createElement("img");
        imageElement.src = url;
        imageElement.style.width = 3 + "rem";
        imageElement.style.height = 3 + "rem";
        images.append(imageElement);
    }

</script>
</body>
</html>